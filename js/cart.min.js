function getCookie(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return""}function createCookie(a,b){Cookies.set(a,b,{expires:1})}function readCookie(a){var b=Cookies.get(a);return void 0==b&&(b=null),b}function eraseCookie(a){Cookies.remove(a)}function getToken(){var a=getCookie("clientId");return window.location.href.includes("admin")&&(a="admin-"+a),a}function saveToCart(a,b,c,d,e){var f=getToken();$.ajax({type:"POST",url:savetocart_url,data:{_csrf:csrf,token:f,sunshade_id:b,sunshade:c,previous:d},success:function(b){a.attr("data-cartid",b),void 0!=e&&location.reload()}})}function removeSunshadeFromCartWithId(a,b){$.ajax({type:"POST",url:removesunshadefromcartwithid_url,data:{_csrf:csrf,cartid:a},success:function(a){void 0!=b&&location.reload()}})}function updateCart(a,b){a.token=getToken(),$.ajax({type:"POST",url:updatecart_url,dataType:"json",data:{_csrf:csrf,data:a},success:function(a){arrayOfSunshades=a.arrayOfSunshades,myCart=a.myCart,void 0!=b&&b()},error:function(a,b,c){console.log(a.responseText)}})}function readCart(a){var b=getToken();$.ajax({type:"GET",url:readcart_url,dataType:"json",data:{token:b},success:function(b){myCart=b,a()}})}function readSunshades(a,b){$.ajax({type:"GET",url:readSunshades_url,dataType:"json",success:function(c){arrayOfSunshades=c,void 0!=b&&b(a)}})}function readMilestoneFromCart(a,b){var c=getToken();$.ajax({type:"GET",url:readmilestone_url,dataType:"json",async:!1,data:{token:c,cartId:a},success:function(a){void 0!=b&&b(a)}})}function addMilestoneToCart(a,b,c,d){$.ajax({type:"POST",url:addMilestoneToCart_url,dataType:"json",data:{_csrf:csrf,cartId:a,arrayOfDates:b,arrayOfMoney:c},success:function(){void 0!=d&&d()},error:function(a,b,c){console.log(a.responseText)}})}function isValidCart(){for(var a=myCart.length-1;a>=0;a--)if(1==myCart[a].valid)return void $(".proceed-cart").removeClass("disabled");$(".proceed-cart").addClass("disabled")}function buildServiceTitle(a){var b=a+msg_days;return 1==a?b=a+msg_day:100==a&&(b=msg_all_season),b}function checkDisableStateOfProceedBtn(){readCart(function(){for(var a=myCart.length-1;a>=0;a--)if(1==myCart[a].valid)return void $(".proceed-cart").removeClass("disabled");$(".proceed-cart").addClass("disabled")})}function validateCartItem(a){count=0;var b=$("#checkin"+a).data("cartid"),c=$("#sunshade"+a).data("sunshade"),d=parseInt($("#checkin"+a).data("sunshadeid"))-1,e=$("#sunshade"+a).children("span.label"),f=$("#checkin"+a+" input").val();f=null==f?"":moment(f,"MMM DD, YYYY").format("YYYY-MM-DD");var g=$("#service"+a).children("option:selected").val(),h=$("#service"+a).children("option:selected").data("day"),h=parseInt(h)-1,i=$("#price"+a).html(),j=$("#price"+a).attr("data-mainprice"),k=$("#price"+a).attr("data-tax"),l=$("#price"+a).attr("data-supplement"),m=$("#price"+a).attr("data-maxguests"),n=$("#guests"+a).val(),o=moment(f),p=o.clone().add(h,"day"),q=moment.range(o,p),r=arrayOfSunshades[d].bookedinfo,s={cartid:b,checkin:f,servicetype:g,guests:n,price:i,mainprice:j,tax:k,supplement:l,maxguests:m,valid:0,token:""};if(null===f||"Invalid date"==f||""==f)return e.removeClass("label-success  glyphicon-ok").addClass("label-danger glyphicon-ban-circle"),s.checkin="",s.servicetype=-1,s.valid=0,updateCart(s,isValidCart),$(".message-warning").html(msg_please_checkin),$(".number").html(c),$("#myModal-warning").modal(),!1;if(g==-1)return e.removeClass("label-success glyphicon-ok").addClass("label-danger glyphicon-ban-circle"),s.servicetype=-1,s.valid=0,$("#price"+a).html(""),updateCart(s,isValidCart),$(".message-warning").html(msg_please_service),$(".number").html(c),$("#myModal-warning").modal(),!1;for(var t=r.length-1;t>=0;t--)if(b!=r[t].Id){var u=moment.range(new Date(r[t].checkin),new Date(r[t].checkout)),v=q.intersect(u);if(v){var w=msg_available_from+moment(r[t].checkin).format("MMM DD, YYYY")+msg_to+moment(r[t].checkout).format("MMM DD, YYYY")+msg_available_to;return $(".message-warning").html(w),$(".number").html(c),$("#myModal-warning").modal(),$("#price"+a).html(""),$("#checkin"+a+" input").val(""),s.checkin="",s.valid=0,e.removeClass("label-success  glyphicon-ok").addClass("label-danger glyphicon-ban-circle"),updateCart(s,isValidCart),!1}}return e.removeClass("label-danger glyphicon-ban-circle").addClass("label-success glyphicon-ok"),s.valid=1,updateCart(s,isValidCart),!0}var main_key="beachclub",search_key="beachclub-search",cart_key="beachclub-cart",milestone_key="beachclub-cart-milestone",viewmode_key="map-view-mode",from_key="from",to_key="to",totalprice_key="total-price",isAdmin=!1,myCart,today=moment().format("MMM DD, YYYY"),_startDate=today,_endDate=moment().add(3,"months").format("MMM DD, YYYY"),currentCart,suffix,count=0;jQuery(document).ready(function(a){function p(b){for(var c=parseInt(b.data("sunshadeid"))-1,d=b.data("cartid"),e=b.data("suffix"),f=[],g=0;g<arrayOfSunshades[c].bookedinfo.length;g++)if(d!=arrayOfSunshades[c].bookedinfo[g].Id){var h=arrayOfSunshades[c].bookedinfo[g].checkin,i=arrayOfSunshades[c].bookedinfo[g].checkout,j=getDates(h,i);f=f.concat(j)}count=0,a("#checkin"+e).datepicker("setDatesDisabled",f).on("changeDate",function(){0==count&&(count=1,window.location.href.includes("bookinfo")?validateCartItemForRoom(e):validateCartItem(e),a(this).datepicker("hide"))})}function q(b){var c=b.data("suffix"),e=(b.data("cartid"),a("#checkin"+c).datepicker("getUTCDate"));e=moment(e,"YYYY-MM-DD HH:mm Z").format("YYYY-MM-DD");var f=parseInt(b.val());b.data("sunshade");1==f?b.prev().prev().children(".bootstrap-touchspin-down").addClass("disabled"):b.prev().prev().children(".bootstrap-touchspin-down").removeClass("disabled"),100==f?b.next().next().children(".bootstrap-touchspin-up").addClass("disabled"):b.next().next().children(".bootstrap-touchspin-up").removeClass("disabled");var h=a("#service"+c).children("option:selected"),j=(parseInt(h.val()),parseInt(h.data("maxguests"))),k=parseInt(h.data("mainprice")),l=parseInt(h.data("tax")),m=parseInt(h.data("supplement")),n=k+m;f>j&&(l=(f-j)*l,n=k+m+l),a("#price"+c).html(n),!validateCartItem(c)}function s(){r++;var b=a("#milestone"),c=b.clone().removeClass("hide").addClass("shown").removeAttr("id").attr("data-milestoneId-index",r);a(".milestone-block").append(c),c.find("#number").html(r+1).end()}function y(b){var c="";t=0;for(var d=0;d<b.length;d++)t+=parseInt(b[d].money),c+='<tr>                                <td class="text-center">'+(d+1)+'</td>                                <td class="text-center">'+b[d].money+'</td>                                <td class="text-center">'+b[d].date+"</td>                            </tr>",a("#milestone-data tbody").append(c);var e="";0==x&&(e="disabled");var f='<div class="modal fade" id="milestone-modal"  data-keyboard="false" tabindex="-1" role="dialog" aria-hidden="true">                                    <div class="modal-dialog modal-lg"  role="document">                                        <div class="modal-content">                                            <div class="modal-header">                                                <button type="button" class="close modal-close" data-dismiss="modal" aria-hidden="true">Ã—</button>                                                <h4 class="modal-title">                                                    '+title_milestone+' <span class="label label-success milestone-sunshade p-r-20">'+v+"</span>                                                    "+title_price+' <span class="label label-success milestone-price">'+x+'</span>                                                </h4>                                            </div>                                            <div class="modal-body">                                                 <div>                                                    <table id="milestone-data" class="table display" cellspacing="0" style="width: 100%">                                                        <thead>                                                            <tr >                                                                <th class="text-center"  data-column-id="id">ID</th>                                                                <th class="text-center" data-column-id="money">'+title_money+'</th>                                                                <th class="text-center" data-column-id="date">'+title_date+"</th>                                                            </tr>                                                        </thead>                                                        <tbody>                                                            "+c+'                                                        </tbody>                                                    </table>                                                </div>                                                <br>                                                <div class="milestone-block">                                                </div>                                            </div>                                            <div class="modal-footer">                                                <button type="button" class="btn btn-success milestone-save '+e+'">'+title_savechange+'</button>                                                <button type="button" class="btn btn-danger" data-dismiss="modal">'+title_close+"</button>                                            </div>                                        </div>                                    </div>                                </div>";a("#myMilestone-dialog").html(f),r=b.length,s(),a(".milestone-block .removeButton").removeClass("btn-danger removeButton").addClass("btn-success addButton").children("i").removeClass("fa-minus").addClass("fa-plus"),a("#milestone-modal span#number").html(r),r-=1,a("#milestone-data").DataTable({pagingType:"full_numbers",language:{url:option_lang}}),a("#milestone-modal").modal("show"),a(".milestone-save").click(function(){function b(){a("#milestone-modal").modal("hide")}if(!a(this).hasClass("disabled")&&validateMilestone(t,x,v)){var c=a(".shown .form-control.Milestone_Price").map(function(){if(""!=a(this).val())return a(this).val()}).get(),d=a(".shown .form-control.Milestone_Date").map(function(){if(""!=a(this).val())return a(this).val()}).get();addMilestoneToCart(u,d,c,b)}}),a("#milestone-modal").on("hidden.bs.modal",function(){a("#myMilestone-dialog").html(""),a("#myModal-warning .overlay").removeClass("c-purple")})}if(a("#grid-data")[0]){for(var b="",c=0;c<myCart.length;c++){w=Math.floor(1e3+9e3*Math.random());var d="label-danger glyphicon glyphicon-ban-circle";1==myCart[c].valid&&(d="label-success glyphicon glyphicon-ok");var e=myCart[c].checkin;e="Invalid date"!=e&&""!=e?moment(myCart[c].checkin).format("MMM DD, YYYY"):"";var f=myCart[c].servicetype;void 0==f&&(f=-1);var g=myCart[c].sunshade[0],h='<div class="mainselection"><select id="service'+w+'"  data-suffix="'+w+'"><option value="-1" data-day="0">'+msg_select_service+"</option>";if(void 0!=arrayOfPrices[g])for(var i=0;i<arrayOfPrices[g].length;i++){var j=arrayOfPrices[g][i],k="";j.servicetype==f&&(k="selected");var l=buildServiceTitle(j.day);h+='<option value="'+j.servicetype+'" data-day="'+j.day+'" data-mainprice="'+j.mainprice+'" data-tax="'+j.tax+'" data-supplement="'+j.supplement+'" data-maxguests="'+j.maxguests+'"'+k+">"+l+"</option>"}h+="</select></div>";var m=myCart[c].guests;void 0==myCart[c].guests&&(m="");var n=myCart[c].price;void 0==n&&(n="");var o="";window.location.href.includes("admin")&&(o='<td class="my-cart"><a style="cursor: pointer" class="milestones valign"                                    id="milestones'+w+'"  data-suffix="'+w+'"                                    data-cartid="'+myCart[c].Id+'" data-sunshade =                                    "'+myCart[c].sunshade+'" title="'+tooltip_milestone+'">['+title_milestone+"]</a>                                </td>"),b+='<tr class="my-cart">                            <td class="my-cart"><div>'+parseInt(c+1)+'</div></td>                            <td class="my-cart"><span class="sunshade-cart valign" id="sunshade'+w+'"                                style="color: #23527c;" data-sunshade="'+myCart[c].sunshade+'">                                    '+myCart[c].sunshade+'                                    <span class="label '+d+'">                                    </span>                                </span>                            </td>                            <td class="my-cart"><div class="input-group date width-170"                                     id="checkin'+w+'" data-cartid="'+myCart[c].Id+'"                                     data-sunshadeid="'+myCart[c].sunshade_id+'" data-suffix="'+w+'">                                    <span class="input-group-addon">                                        <span class="glyphicon glyphicon-calendar"></span>                                    </span>                                    <input type="text" readonly="readonly" class="form-control"                                    name="checkin[]" value="'+e+'"/>                                    </div>                            </td>                            <td class="my-cart">'+h+'</td>                            <td class="my-cart"><input class="guests text-center" id="guests'+w+'"                                type="text" value="'+m+'"  name="guests[]"                                data-sunshade="'+myCart[c].sunshade+'"  data-suffix="'+w+'"                                data-cartid="'+myCart[c].Id+'">                            </td>                            <td class="my-cart height-40"><div class="price valign" id="price'+w+'"                                data-suffix="'+w+'" data-mainprice=""                                data-supplement="" data-tax="" data-maxguests="">'+n+'</div>                            </td>                            <td class="my-cart"><div><a style="cursor: pointer" class="cart valign"                                id="cart'+w+'"  data-suffix="'+w+'"                                data-cartid="'+myCart[c].Id+'" title="'+tooltip_remove+'">'+title_remove+"</a></div>                            </td>                            "+o+'                            <td class="my-cart"><div><span class="input-group-btn ">                                    <button class="btn btn-success btn-number glyphicon                                    glyphicon-plus bootstrap-touchspin-up plus" id="plus'+w+'"                                    data-suffix="'+w+'" data-cartid="'+myCart[c].Id+'"                                    data-sunshadeid="'+myCart[c].sunshade_id+'"                                    data-sunshade="'+myCart[c].sunshade+'" data-previous="'+myCart[c].previous+'" type="button" title="'+tooltip_new+'">                                    </button>                                </span></div>                            </td>                        </tr>'}a("#grid-data tbody").append(b),a(".input-group.date").click(function(){var b=a(this);readSunshades(b,p)}),a(".mainselection select").change(function(){var b=a(this).children("option:selected"),c=b.data("maxguests"),d=b.data("mainprice"),e=b.data("tax"),f=b.data("supplement"),g=a(this).data("suffix");a(this).parent().parent().siblings(".guests").val(c);var h=d+f;a("#price"+g).html(h).attr("data-tax",e).attr("data-supplement",f).attr("data-mainprice",d).attr("data-maxguests",c),a("#guests"+g).val(c),validateCartItem(g)||a(this).children("option[value=-1]").prop("selected",!0)}),a(".guests").TouchSpin({initval:1,min:1,buttondown_class:"btn btn-danger btn-number glyphicon glyphicon-minus",buttonup_class:"btn btn-success btn-number glyphicon glyphicon-plus"}).on("touchspin.on.stopspin",function(b){q(a(this))}).on("change",function(b){q(a(this))}),a(".btn.btn-number").text(""),a(".cart").click(function(){var b=a(this).data("cartid");a(this).data("suffix");removeSunshadeFromCartWithId(b,location.reload)});var r=0;if(a(".milestones")[0]){a("body").on("click touchend",".Milestone_Date",function(){a(this).datepicker({autoclose:!0,todayHighlight:!0,format:"M dd, yyyy",orientation:"auto up",keyboardNavigation:!0,startDate:today,ignoreReadonly:!0,showOnFocus:!0}).datepicker("show")}),a("body").on("click",".addButton",function(){s()}).on("click",".removeButton",function(){var b=a(this).parents(".template");b.attr("data-milestone-index");b.remove(),r--});var t,u,v,w,x;a(".milestones").click(function(){u=a(this).data("cartid"),v=a(this).data("sunshade"),w=a(this).data("suffix"),x=a("#price"+w).html(),readMilestoneFromCart(u,y)})}a(".plus").click(function(){var c=(a(this).data("cartid"),a(this).data("sunshadeid")),d=a(this).data("sunshade"),e=a(this).data("previous");a(this).data("suffix");saveToCart(a(this),c,d,e,location.reload)}),checkDisableStateOfProceedBtn(),a("body").on("click",".proceed-cart",function(b){b.preventDefault(),a(this).hasClass("disabled")||a("#gotocart-form").submit()}),adjustTableStyle("#grid-data"),a('th[data-column-id="id"]').addClass("width-50"),a('th[data-column-id="sunshade"]').addClass("width-150"),a('th[data-column-id="checkin"]').addClass("width-170"),a('th[data-column-id="servicetype"]').addClass("width-150"),a('th[data-column-id="guests"]').addClass("width-150"),a('th[data-column-id="price"]').addClass("width-150"),a('th[data-column-id="cart"]').addClass("width-150"),a('th[data-column-id="milestone"]').addClass("width-150"),a('th[data-column-id="add"]').addClass("width-150"),a("#grid-data").DataTable({pagingType:"full_numbers",language:{url:option_lang}})}if(a("#cartinfo-data")[0]){for(var b="",c=0;c<myCart.length;c++){var A=0;myCart[c].guests>myCart[c].maxguests&&(A=myCart[c].tax);var e=moment(myCart[c].checkin).format("MMM DD, YYYY"),g=myCart[c].sunshade[0],f=parseInt(myCart[c].servicetype),B="";if(void 0!=arrayOfPrices[g])for(var i=0;i<arrayOfPrices[g].length;i++){var j=arrayOfPrices[g][i];j.servicetype==f&&(B=buildServiceTitle(j.day))}b+="<tr class='my-cart'>                            <td class='my-cart text-center'><div>"+(parseInt(c)+1)+"</div></td>                            <td class='my-cart text-center'><div>"+myCart[c].sunshade+"</div></td>                            <td class='my-cart text-center'><div>"+e+"</div></td>                            <td class='my-cart text-center'><div>"+B+"</div></td>                            <td class='my-cart text-center'><div>"+myCart[c].guests+"</div></td>                            <td class='my-cart text-center'><div>"+myCart[c].price+"</div></td>                            <td class='my-cart text-center'><div>"+myCart[c].mainprice+"</div></td>                            <td class='my-cart text-center'><div>"+myCart[c].supplement+"</div></td>                            <td class='my-cart text-center'><div>"+A+"</div></td>                        </tr>"}a("#cartinfo-data tbody").append(b),adjustTableStyle("#cartinfo-data"),a("#cartinfo-data").DataTable({dom:"Bfrtip",buttons:["copyHtml5","excelHtml5","csvHtml5","pdfHtml5","print"],pagingType:"full_numbers",language:{url:option_lang}})}if(a("#price-data")[0]){for(var b="",c=0;c<arrayOfPrices.length;c++)command='<button type="button" class="btn btn-icon command-view waves-effect waves-circle"                 data-row-id="'+arrayOfPrices[c].Id+'" title="'+tooltip_view+'"><span class="zmdi zmdi-view-toc zmdi-hc-fw"></span></button>                 &nbsp;&nbsp;&nbsp;<button type="button" class="btn btn-icon command-edit waves-effect waves-circle" data-toggle="modal"                 data-row-id="'+arrayOfPrices[c].Id+'" title="'+tooltip_edit+'"><span class="zmdi zmdi-edit"></span></button>                 &nbsp;&nbsp;&nbsp; <button type="button" class="btn btn-icon command-delete waves-effect waves-circle bgm-red"                 data-row-id="'+arrayOfPrices[c].Id+'" title="'+tooltip_delete+'"><span class="fa fa-trash-o"></span></button>',b+="<tr class='my-cart'>                            <td class='my-cart'><div>"+parseInt(c+1)+"</div></td>                            <td class='my-cart'><div>"+arrayOfPrices[c].rowid+"</div></td>                            <td class='my-cart'><div>"+arrayOfPrices[c].servicename+"</div></td>                            <td class='my-cart'><div>"+arrayOfPrices[c].mainprice+"</div></td>                            <td class='my-cart'><div>"+arrayOfPrices[c].tax+"</div></td>                            <td class='my-cart'><div>"+arrayOfPrices[c].supplement+"</div></td>                            <td class='my-cart'><div>"+arrayOfPrices[c].maxguests+"</div></td>                            <td class='my-cart'><div>"+command+"</div></td>                        </tr>";a("#price-data tbody").append(b),adjustTableStyle("#price-data"),a("#price-data").DataTable({dom:"Bfrtip",buttons:["copyHtml5","excelHtml5","csvHtml5","pdfHtml5","print"],pagingType:"full_numbers",language:{url:option_lang}}),a(".command-view").click(function(){viewUrl+="&id="+a(this).data("row-id"),location.href=viewUrl}),a(".command-edit").click(function(){updateUrl+="&id="+a(this).data("row-id"),location.href=updateUrl}),a(".command-delete").click(function(){var b=a(this);swal({title:msg_sure,text:title_modal,type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:msg_yes,cancelButtonText:msg_no,closeOnConfirm:!1,closeOnCancel:!1},function(c){return c?void a.ajax({url:deleteUrl,type:"POST",data:{id:b.data("row-id"),lang:lang},success:function(a){}}):(swal(msg_canceled,title_cancel,"error"),!1)})})}if(a("#price-info")[0]){for(var b="",c=0;c<arrayOfPrices.length;c++)b+="<tr class='my-cart'>                            <td class='my-cart'><div>"+parseInt(c+1)+"</div></td>                            <td class='my-cart'><div>"+arrayOfPrices[c].rowid+"</div></td>                            <td class='my-cart'><div>"+arrayOfPrices[c].servicename+"</div></td>                            <td class='my-cart'><div>"+arrayOfPrices[c].mainprice+"</div></td>                            <td class='my-cart'><div>"+arrayOfPrices[c].tax+"</div></td>                            <td class='my-cart'><div>"+arrayOfPrices[c].supplement+"</div></td>                            <td class='my-cart'><div>"+arrayOfPrices[c].maxguests+"</div></td>                        </tr>";a("#price-info tbody").append(b),adjustTableStyle("#price-info"),a("#price-info").DataTable({dom:"Bfrtip",buttons:["copyHtml5","excelHtml5","csvHtml5","pdfHtml5","print"],pagingType:"full_numbers",language:{url:option_lang}})}});